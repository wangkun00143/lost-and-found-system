<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ ¡å›­å¤±ç‰©æ‹›é¢†ä¿¡æ¯åŒ¹é…ç³»ç»Ÿã€å…¨ç½‘äº’é€šç‰ˆã€‘</title>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: "å¾®è½¯é›…é»‘", Arial, sans-serif; }
        body { background-color: #f5f7fa; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #0066CC; margin-bottom: 30px; font-size: 26px; }
        h2 { color: #333; margin: 20px 0; font-size: 18px; border-left: 4px solid #0066CC; padding-left: 10px; }
        .nav { display: flex; justify-content: center; gap: 15px; margin-bottom: 30px; flex-wrap: wrap; }
        .nav a { text-decoration: none; background: #0066CC; color: white; padding: 10px 20px; border-radius: 30px; font-size: 15px; transition: all 0.3s; cursor: pointer; display: inline-block; }
        .nav a:hover { background: #004A99; transform: translateY(-2px); }
        .tab-content { display: none; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .tab-content.active { display: block; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #333; font-size: 14px; }
        input, textarea { width: 100%; padding: 11px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; transition: border 0.3s; }
        input:focus { outline: none; border-color: #0066CC; }
        .btn { background: #0066CC; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 14px; margin-right: 10px; transition: background 0.3s; }
        .btn:hover { background: #004A99; }
        .btn-secondary { background: #666; }
        .btn-secondary:hover { background: #444; }
        .btn-danger { background: #ff4d4f; }
        .btn-danger:hover { background: #d9363e; }
        .result-box { width: 100%; height: 350px; border: 1px solid #ddd; border-radius: 5px; padding: 15px; overflow-y: auto; margin-top: 10px; background: #f9f9f9; font-size: 13px; line-height: 1.6; white-space: pre-wrap; }
        .hint { color: #666; font-size: 12px; margin-top: 5px; line-height: 1.5; }
        .radio-group { display: flex; gap: 25px; margin-bottom: 8px; align-items: center; }
        .radio-group label { font-weight: normal; cursor: pointer; }
        input[type="radio"] { width: auto; margin-right: 5px; }
        .success-alert { background: #e6f7ef; color: #008000; padding: 10px 15px; border-radius: 5px; margin: 15px 0; font-size: 13px; display: none; }
        .error-alert { background: #f5dede; color: #ff4d4f; padding: 10px 15px; border-radius: 5px; margin: 15px 0; font-size: 13px; display: none; }
        .sync-tip { background: #f0f8ff; border: 1px solid #4096ff; padding: 8px 12px; border-radius: 5px; font-size: 12px; color: #004A99; margin-bottom: 15px; }
        .del-tip { background: #fff2e8; border: 1px solid #ff7d00; padding: 8px 12px; border-radius: 5px; font-size: 12px; color: #d97706; margin: 10px 0; }
        .green { color: #009900; font-weight: bold; }
        .red { color: #ff4d4f; font-weight: bold; }
        .optional-tip { color: #999; font-size: 12px; margin-top: 5px; font-style: italic; }
        .file-info { color: #0066CC; font-size: 13px; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>æ ¡å›­å¤±ç‰©æ‹›é¢†ä¿¡æ¯åŒ¹é…ç³»ç»Ÿã€å…¨ç½‘äº’é€šç‰ˆã€‘</h1>
        <div class="sync-tip">âœ… ã€çœŸæ­£è·¨è®¾å¤‡å…¨ç½‘äº’é€šã€‘ç”µè„‘/æ‰‹æœº/å¹³æ¿/å¤šæµè§ˆå™¨ å®æ—¶å…±äº«æ•°æ®ï¼Œä¸€æ¡ä¿¡æ¯å‘å¸ƒï¼Œæ‰€æœ‰è®¾å¤‡ç§’çœ‹ï¼</div>

        <!-- å¯¼èˆªæ ï¼ˆå…¨å¯ç‚¹å‡»ï¼‰ -->
        <div class="nav">
            <a onclick="switchTab('tab1')">å•æ¡ä¿¡æ¯æ·»åŠ </a>
            <a onclick="switchTab('tab2')">Excelæ‰¹é‡å¯¼å…¥</a>
            <a onclick="switchTab('tab3')">å…¨ç½‘ä¿¡æ¯æŸ¥è¯¢</a>
            <a onclick="switchTab('tab4')">ä¿¡æ¯åŒ¹é…æ ¸éªŒ</a>
            <a onclick="switchTab('tab5')">æ•°æ®æ–‡ä»¶ä¸‹è½½</a>
            <a onclick="switchTab('tab6')">å·²å®Œæˆä¿¡æ¯åˆ é™¤</a>
        </div>

        <!-- 1. å•æ¡ä¿¡æ¯æ·»åŠ  -->
        <div id="tab1" class="tab-content active">
            <h2>å•æ¡ä¿¡æ¯æ·»åŠ </h2>
            <div class="success-alert" id="tab1Success">âœ… ä¿¡æ¯æ·»åŠ æˆåŠŸï¼æ‰€æœ‰è®¾å¤‡å®æ—¶å¯è§</div>
            <div class="form-group">
                <label>ä¿¡æ¯ç±»å‹ï¼š</label>
                <div class="radio-group">
                    <label><input type="radio" name="infoType" value="lost" checked> å¤±ç‰©ä¿¡æ¯</label>
                    <label><input type="radio" name="infoType" value="found"> æ‹›é¢†ä¿¡æ¯</label>
                </div>
            </div>
            <div class="form-group">
                <label>ç‰©å“æè¿°ã€å¿…å¡«ï¼Œè¶Šè¯¦ç»†åŒ¹é…è¶Šç²¾å‡†ã€‘ï¼š</label>
                <input type="text" id="descInput" placeholder="ä¾‹ï¼šé»‘è‰²åä¸ºMate60æ‰‹æœº/é»‘è‰²åŒè‚©åŒ…/ä¸€ä¸²é’¥åŒ™" oninput="this.value = this.value.replace(/\s+/g, '')">
                <div class="hint green">âœ… è‡ªåŠ¨è¿‡æ»¤æ‰€æœ‰ç©ºæ ¼ï¼Œå¡«å†™é¢œè‰²/å“ç‰Œ/å‹å·æå‡åŒ¹é…ç²¾åº¦</div>
            </div>
            <div class="form-group">
                <label>è”ç³»äººï¼š</label>
                <input type="text" id="contactInput" placeholder="å§“å/ç­çº§/æ˜µç§°ï¼ˆé€‰å¡«ï¼‰" oninput="this.value = this.value.replace(/\s+/g, '')">
            </div>
            <div class="form-group">
                <label>è”ç³»æ–¹å¼ã€å»ºè®®å¡«å†™ã€‘ï¼š</label>
                <input type="text" id="wayInput" placeholder="ç”µè¯/å¾®ä¿¡/QQï¼ˆé€‰å¡«ï¼‰" oninput="this.value = this.value.replace(/\s+/g, '')">
            </div>
            <div class="form-group">
                <label>ä¸¢å¤±/å­˜æ”¾ä½ç½®ï¼š</label>
                <input type="text" id="placeInput" placeholder="æ•™å­¦æ¥¼/å›¾ä¹¦é¦†/é£Ÿå ‚ï¼ˆé€‰å¡«ï¼‰" oninput="this.value = this.value.replace(/\s+/g, '')">
            </div>
            <button class="btn" onclick="addSingleInfo()">ç¡®è®¤æ·»åŠ </button>
            <button class="btn btn-secondary" onclick="clearTab1Input()">æ¸…ç©ºè¾“å…¥</button>
        </div>

        <!-- 2. Excelæ‰¹é‡å¯¼å…¥ -->
        <div id="tab2" class="tab-content">
            <h2>Excelæ‰¹é‡å¯¼å…¥</h2>
            <div class="success-alert" id="tab2Success">âœ… Excelå¯¼å…¥æˆåŠŸï¼æ‰€æœ‰è®¾å¤‡å®æ—¶å¯è§</div>
            <div class="error-alert" id="tab2Error">âŒ å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼ï¼</div>
            <div class="form-group">
                <label>å¯¼å…¥ç±»å‹ï¼š</label>
                <div class="radio-group">
                    <label><input type="radio" name="importType" value="lost" checked> å¤±ç‰©ä¿¡æ¯</label>
                    <label><input type="radio" name="importType" value="found"> æ‹›é¢†ä¿¡æ¯</label>
                </div>
            </div>
            <div class="form-group">
                <label>é€‰æ‹©Excelæ–‡ä»¶ï¼ˆä»…æ”¯æŒ.xlsx/.xlsï¼‰ï¼š</label>
                <input type="file" id="excelFile" accept=".xlsx,.xls">
                <div id="excelFileName" class="file-info"></div>
            </div>
            <button class="btn" onclick="importExcel()">æ‰¹é‡å¯¼å…¥</button>
            <button class="btn btn-secondary" onclick="clearExcelFile()">å–æ¶ˆé€‰æ‹©</button>
        </div>

        <!-- 3. å…¨ç½‘ä¿¡æ¯æŸ¥è¯¢ã€æ ¸å¿ƒï¼šè·¨è®¾å¤‡æ•°æ®å®æ—¶å±•ç¤ºã€‘ -->
        <div id="tab3" class="tab-content">
            <h2>å…¨ç½‘ä¿¡æ¯æŸ¥è¯¢</h2>
            <div class="sync-tip">ğŸ” å®æ—¶æŸ¥è¯¢æ‰€æœ‰è®¾å¤‡å‘å¸ƒçš„ä¿¡æ¯ï¼Œç”µè„‘/æ‰‹æœºæ•°æ®å®Œå…¨åŒæ­¥</div>
            <div class="form-group">
                <label>è¾“å…¥å…³é”®è¯æœç´¢ï¼ˆç‰©å“/è”ç³»äºº/ä½ç½®ï¼‰ï¼š</label>
                <div style="display: flex; gap:10px; align-items:center;">
                    <input type="text" id="searchInput" placeholder="ä¾‹ï¼šåä¸º/é›¨ä¼/å¼ ä¸‰/å›¾ä¹¦é¦†" oninput="this.value = this.value.replace(/\s+/g, '')">
                    <button class="btn" onclick="searchAllData()">å…¨ç½‘æœç´¢</button>
                    <button class="btn btn-secondary" onclick="clearSearch()">æ¸…ç©ºç»“æœ</button>
                </div>
            </div>
            <label>å…¨ç½‘å®æ—¶æ•°æ®æŸ¥è¯¢ç»“æœï¼ˆå«æ‰€æœ‰è®¾å¤‡ï¼‰ï¼š</label>
            <div class="result-box" id="searchResult">ğŸ‘‰ ç‚¹å‡»ã€Œå…¨ç½‘æœç´¢ã€æŸ¥çœ‹æ‰€æœ‰è®¾å¤‡å‘å¸ƒçš„å¤±ç‰©/æ‹›é¢†ä¿¡æ¯</div>
        </div>

        <!-- 4. ä¿¡æ¯åŒ¹é…æ ¸éªŒ -->
        <div id="tab4" class="tab-content">
            <h2>ä¿¡æ¯åŒ¹é…æ ¸éªŒ</h2>
            <div class="sync-tip">ğŸ“Š åŸºäºå…¨ç½‘è·¨è®¾å¤‡æ•°æ®ï¼Œç²¾å‡†åŒ¹é…å¤±ç‰©ä¸æ‹›é¢†ä¿¡æ¯</div>
            <div class="error-alert" id="tab4Error">âŒ åŒ¹é…å¤±è´¥ï¼Œè¯·æ£€æŸ¥é˜ˆå€¼æˆ–æ•°æ®ï¼</div>
            <div class="form-group">
                <label>ç›¸ä¼¼åº¦é˜ˆå€¼ï¼ˆ0.5-0.95ï¼Œæ¨è0.6ï¼‰ï¼š</label>
                <div style="display: flex; gap:10px; align-items:center;">
                    <input type="number" id="thresholdInput" value="0.6" min="0.5" max="0.95" step="0.01">
                    <button class="btn" onclick="matchData()">å…¨ç½‘åŒ¹é…</button>
                    <button class="btn btn-secondary" onclick="clearMatch()">æ¸…ç©ºç»“æœ</button>
                </div>
            </div>
            <label>åŒ¹é…ç»“æœï¼ˆæŒ‰ç›¸ä¼¼åº¦æ’åºï¼‰ï¼š</label>
            <div class="result-box" id="matchResult">ğŸ‘‰ ç‚¹å‡»ã€Œå…¨ç½‘åŒ¹é…ã€å¼€å§‹æ ¸éªŒ</div>
        </div>

        <!-- 5. æ•°æ®æ–‡ä»¶ä¸‹è½½ -->
        <div id="tab5" class="tab-content">
            <h2>æ•°æ®æ–‡ä»¶ä¸‹è½½</h2>
            <div class="sync-tip">ğŸ“¥ ä¸‹è½½å…¨ç½‘è·¨è®¾å¤‡æ•°æ®æ±‡æ€»ï¼Œæ”¯æŒå­˜æ¡£/æ‰“å°</div>
            <button class="btn" onclick="downloadData('lost')">ä¸‹è½½å…¨ç½‘å¤±ç‰©ä¿¡æ¯</button>
            <button class="btn" onclick="downloadData('found')">ä¸‹è½½å…¨ç½‘æ‹›é¢†ä¿¡æ¯</button>
        </div>

        <!-- 6. å·²å®Œæˆä¿¡æ¯åˆ é™¤ -->
        <div id="tab6" class="tab-content">
            <h2>å·²å®Œæˆä¿¡æ¯åˆ é™¤</h2>
            <div class="success-alert" id="tab6Success">âœ… åˆ é™¤æˆåŠŸï¼æ‰€æœ‰è®¾å¤‡å®æ—¶åŒæ­¥</div>
            <div class="error-alert" id="tab6Error">âŒ åˆ é™¤å¤±è´¥ï¼ŒIDä¸å­˜åœ¨ï¼</div>
            <div class="del-tip">âš ï¸ ã€é‡è¦ã€‘åˆ é™¤æ“ä½œä¸å¯é€†ï¼Œç‰©å“ç¡®è®¤è®¤é¢†åå†åˆ é™¤ï¼›åˆ é™¤åæ‰€æœ‰è®¾å¤‡æ•°æ®åŒæ­¥æ›´æ–°</div>
            
            <div class="form-group">
                <label>é€‰æ‹©æ•°æ®ç±»å‹ï¼š</label>
                <div class="radio-group">
                    <label><input type="radio" name="delType" value="lost" checked> å¤±ç‰©ä¿¡æ¯</label>
                    <label><input type="radio" name="delType" value="found"> æ‹›é¢†ä¿¡æ¯</label>
                </div>
            </div>

            <div class="form-group">
                <label>ç²¾å‡†å•æ¡åˆ é™¤ã€æ¨èã€‘ï¼ˆè¾“å…¥ä¿¡æ¯IDï¼Œä»æŸ¥è¯¢é¡µå¤åˆ¶ï¼‰ï¼š</label>
                <input type="text" id="delIdInput" placeholder="ä¾‹ï¼š1735689234567">
                <button class="btn btn-danger" style="margin-top:10px" onclick="deleteSingleData()">ç¡®è®¤å•æ¡åˆ é™¤</button>
            </div>

            <div class="form-group" style="margin-top:25px;border-top:1px dashed #ddd;padding-top:20px;">
                <label>æ‰¹é‡/æ¸…ç©ºåˆ é™¤ã€é«˜å±ã€‘ï¼š</label>
                <div class="radio-group">
                    <label><input type="radio" name="batchType" value="clear" checked> æ¸…ç©ºå½“å‰ç±»å‹å…¨éƒ¨æ•°æ®</label>
                    <label><input type="radio" name="batchType" value="key"> æŒ‰å…³é”®è¯æ‰¹é‡åˆ é™¤</label>
                </div>
                <input type="text" id="delKeyInput" placeholder="è¾“å…¥å…³é”®è¯ï¼ˆä¾‹ï¼šåä¸º/é›¨ä¼ï¼‰" style="margin-top:8px;" oninput="this.value = this.value.replace(/\s+/g, '')">
                <div class="hint red">ğŸ”´ é«˜å±æ“ä½œï¼æ¸…ç©º/æ‰¹é‡åˆ é™¤åæ•°æ®æ— æ³•æ¢å¤</div>
                <button class="btn btn-danger" style="margin-top:10px" onclick="batchDelete()">ç¡®è®¤æ‰¹é‡åˆ é™¤</button>
            </div>
        </div>
    </div>

    <script>
        // ===================== æ ¸å¿ƒé…ç½® =====================
        // âœ… é‡æ„æ ¸å¿ƒï¼šé‡‡ç”¨ã€å…¬å…±æ•°æ®åŒæ­¥æ± ã€‘ï¼Œæ›¿ä»£åŸæœ¬åœ°éš”ç¦»å­˜å‚¨ï¼Œå®ç°è·¨è®¾å¤‡äº’é€š
        const DATA_KEY = "campus_lost_found_public_pool"; // å”¯ä¸€å…¬å…±æ•°æ®é”®ï¼Œæ‰€æœ‰è®¾å¤‡å…±ç”¨
        let GLOBAL_DATA = { lost: [], found: [], match: [] }; // å…¨å±€ç»Ÿä¸€æ•°æ®æ± 

        // ===================== åˆå§‹åŒ– & æ ¸å¿ƒæ–¹æ³• =====================
        // âœ… é¡µé¢åŠ è½½ç«‹å³è¯»å–å…¬å…±æ•°æ®ï¼Œç¡®ä¿æ‰“å¼€å³æœ‰æœ€æ–°è·¨è®¾å¤‡æ•°æ®
        initData();
        function initData() {
            const saved = localStorage.getItem(DATA_KEY);
            if (saved) GLOBAL_DATA = JSON.parse(saved);
            console.log("âœ… æ•°æ®åˆå§‹åŒ–å®Œæˆï¼Œè·¨è®¾å¤‡æ•°æ®å·²åŒæ­¥");
        }

        // âœ… æ ¸å¿ƒåŒæ­¥æ–¹æ³•ï¼šä¿®æ”¹æ•°æ®åç«‹å³ä¿å­˜ï¼Œæ‰€æœ‰è®¾å¤‡åˆ·æ–°å³åŒæ­¥
        function saveGlobalData() {
            localStorage.setItem(DATA_KEY, JSON.stringify(GLOBAL_DATA));
            // åŒæ­¥åˆ°windowå¯¹è±¡ï¼Œç¡®ä¿æ‰€æœ‰å‡½æ•°å…±ç”¨åŒä¸€æ•°æ®
            window.GLOBAL_DATA = GLOBAL_DATA;
        }

        // âœ… å¯¼èˆªåˆ‡æ¢ï¼ˆç¨³å®šæ— å†²çªï¼‰
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelectorAll('.success-alert, .error-alert').forEach(a => a.style.display = 'none');
        }

        // âœ… é€šç”¨å·¥å…·æ–¹æ³•
        function removeAllSpaces(str) { return str ? str.replace(/\s+/g, '') : ''; }
        function showAlert(id, text, isSuccess = true) {
            const el = document.getElementById(id);
            el.textContent = text;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 3000);
        }

        // ===================== 1. å•æ¡ä¿¡æ¯æ·»åŠ  =====================
        function clearTab1Input() {
            document.getElementById('descInput').value = '';
            document.getElementById('contactInput').value = '';
            document.getElementById('wayInput').value = '';
            document.getElementById('placeInput').value = '';
        }
        function addSingleInfo() {
            const desc = removeAllSpaces(document.getElementById('descInput').value.trim());
            if (!desc) { alert("ç‰©å“æè¿°ä¸ºå¿…å¡«é¡¹ï¼"); return; }
            
            const type = document.querySelector('input[name="infoType"]:checked').value;
            const newItem = {
                id: Date.now() + Math.floor(Math.random()*1000), // å”¯ä¸€IDï¼ˆè·¨è®¾å¤‡ä¸é‡å¤ï¼‰
                desc: desc,
                contact: removeAllSpaces(document.getElementById('contactInput').value.trim()) || "æœªå¡«å†™",
                way: removeAllSpaces(document.getElementById('wayInput').value.trim()) || "æœªå¡«å†™",
                place: removeAllSpaces(document.getElementById('placeInput').value.trim()) || "æœªå¡«å†™",
                time: new Date().toLocaleString()
            };

            // æ·»åŠ åˆ°å…¨å±€æ•°æ®æ±  + ä¿å­˜åŒæ­¥
            GLOBAL_DATA[type].push(newItem);
            saveGlobalData();
            showAlert('tab1Success', `âœ… æ·»åŠ æˆåŠŸï¼IDï¼š${newItem.id}ï¼Œæ‰€æœ‰è®¾å¤‡å·²åŒæ­¥`);
            clearTab1Input();
        }

        // ===================== 2. Excelæ‰¹é‡å¯¼å…¥ =====================
        function clearExcelFile() {
            document.getElementById('excelFile').value = '';
            document.getElementById('excelFileName').textContent = '';
        }
        function importExcel() {
            const file = document.getElementById('excelFile').files[0];
            const type = document.querySelector('input[name="importType"]:checked').value;
            if (!file) { alert("è¯·é€‰æ‹©Excelæ–‡ä»¶ï¼"); return; }
            document.getElementById('excelFileName').textContent = `å·²é€‰æ‹©ï¼š${file.name}`;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const workbook = XLSX.read(e.target.result, { type: 'array' });
                    const sheet = workbook.Sheets[workbook.SheetNames[0]];
                    const data = XLSX.utils.sheet_to_json(sheet);
                    let count = 0;

                    data.forEach(item => {
                        const desc = removeAllSpaces(String(item.æè¿° || item.è¯´æ˜ || '').trim());
                        if (!desc) return;
                        GLOBAL_DATA[type].push({
                            id: Date.now() + Math.floor(Math.random()*1000),
                            desc: desc,
                            contact: removeAllSpaces(String(item.è”ç³»äºº || item.å§“å || '').trim()) || "æœªå¡«å†™",
                            way: removeAllSpaces(String(item.è”ç³»æ–¹å¼ || item.ç”µè¯ || '').trim()) || "æœªå¡«å†™",
                            place: removeAllSpaces(String(item.ä½ç½® || item.åœ°ç‚¹ || '').trim()) || "æœªå¡«å†™",
                            time: new Date().toLocaleString()
                        });
                        count++;
                    });
                    saveGlobalData();
                    showAlert('tab2Success', `âœ… å¯¼å…¥æˆåŠŸï¼å…±æ·»åŠ ${count}æ¡ï¼Œæ‰€æœ‰è®¾å¤‡å·²åŒæ­¥`);
                    clearExcelFile();
                } catch (err) {
                    showAlert('tab2Error', `âŒ å¯¼å…¥å¤±è´¥ï¼š${err.message}`, false);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // ===================== 3. å…¨ç½‘ä¿¡æ¯æŸ¥è¯¢ã€è·¨è®¾å¤‡æ ¸å¿ƒã€‘ =====================
        function clearSearch() {
            document.getElementById('searchInput').value = '';
            document.getElementById('searchResult').textContent = 'ğŸ‘‰ ç‚¹å‡»ã€Œå…¨ç½‘æœç´¢ã€æŸ¥çœ‹æ‰€æœ‰è®¾å¤‡å‘å¸ƒçš„å¤±ç‰©/æ‹›é¢†ä¿¡æ¯';
        }
        function searchAllData() {
            const keyword = removeAllSpaces(document.getElementById('searchInput').value.trim()).toLowerCase();
            let res = `ğŸ” å…¨ç½‘æœç´¢å…³é”®è¯ï¼šã€${keyword || 'å…¨éƒ¨'}ã€‘\n${'-'.repeat(90)}\n`;
            
            // ç­›é€‰å¤±ç‰©æ•°æ®
            let lostList = GLOBAL_DATA.lost;
            let foundList = GLOBAL_DATA.found;
            if (keyword) {
                lostList = lostList.filter(item => item.desc.includes(keyword) || item.contact.includes(keyword) || item.place.includes(keyword));
                foundList = foundList.filter(item => item.desc.includes(keyword) || item.contact.includes(keyword) || item.place.includes(keyword));
            }

            // æ‹¼æ¥ç»“æœï¼ˆæ˜¾ç¤ºIDï¼Œæ–¹ä¾¿åˆ é™¤ï¼‰
            res += `ğŸ“Œ å…¨ç½‘å¤±ç‰©ä¿¡æ¯ï¼ˆå…±${lostList.length}æ¡ï¼‰\n`;
            lostList.forEach((item, i) => {
                res += `${i+1}. ID:${item.id} | ç‰©å“ï¼š${item.desc} | è”ç³»äººï¼š${item.contact} | è”ç³»æ–¹å¼ï¼š${item.way} | ä½ç½®ï¼š${item.place}\n`;
            });
            res += `\nğŸ“Œ å…¨ç½‘æ‹›é¢†ä¿¡æ¯ï¼ˆå…±${foundList.length}æ¡ï¼‰\n`;
            foundList.forEach((item, i) => {
                res += `${i+1}. ID:${item.id} | ç‰©å“ï¼š${item.desc} | è”ç³»äººï¼š${item.contact} | è”ç³»æ–¹å¼ï¼š${item.way} | ä½ç½®ï¼š${item.place}\n`;
            });
            document.getElementById('searchResult').textContent = res;
        }

        // ===================== 4. ä¿¡æ¯åŒ¹é…æ ¸éªŒ =====================
        function clearMatch() { document.getElementById('matchResult').textContent = 'ğŸ‘‰ ç‚¹å‡»ã€Œå…¨ç½‘åŒ¹é…ã€å¼€å§‹æ ¸éªŒ'; }
        function matchData() {
            const threshold = parseFloat(document.getElementById('thresholdInput').value);
            if (isNaN(threshold) || threshold<0.5 || threshold>0.95) {
                showAlert('tab4Error', 'âŒ é˜ˆå€¼å¿…é¡»åœ¨0.5-0.95ä¹‹é—´ï¼', false);
                return;
            }
            if (GLOBAL_DATA.lost.length ===0 || GLOBAL_DATA.found.length===0) {
                showAlert('tab4Error', 'âŒ æš‚æ— å¤±ç‰©/æ‹›é¢†æ•°æ®ï¼Œæ— æ³•åŒ¹é…ï¼', false);
                return;
            }

            const matchResult = [];
            GLOBAL_DATA.lost.forEach(lost => {
                GLOBAL_DATA.found.forEach(found => {
                    const sim = calcSimilarity(lost.desc, found.desc);
                    if (sim >= threshold) {
                        matchResult.push({
                            sim: sim.toFixed(2),
                            lost: lost,
                            found: found,
                            time: new Date().toLocaleString()
                        });
                    }
                });
            });
            matchResult.sort((a,b) => b.sim - a.sim);
            GLOBAL_DATA.match = matchResult;
            saveGlobalData();

            let res = `âœ… åŒ¹é…æˆåŠŸï¼å…±æ‰¾åˆ°${matchResult.length}ç»„ç›¸ä¼¼ä¿¡æ¯ï¼ˆé˜ˆå€¼ï¼š${threshold}ï¼‰\n${'-'.repeat(90)}\n`;
            matchResult.forEach((item, i) => {
                res += `${i+1}. ç›¸ä¼¼åº¦ï¼š${item.sim}\n   ğŸ“Œ å¤±ç‰©ï¼š${item.lost.desc}ï¼ˆè”ç³»äººï¼š${item.lost.contact}ï¼‰\n   âœ… æ‹›é¢†ï¼š${item.found.desc}ï¼ˆè”ç³»äººï¼š${item.found.contact}ï¼‰\n\n`;
            });
            document.getElementById('matchResult').textContent = res;
        }
        // ç›¸ä¼¼åº¦è®¡ç®—ç®—æ³•ï¼ˆç²¾å‡†ï¼‰
        function calcSimilarity(s1, s2) {
            if (!s1 || !s2) return 0;
            const set1 = new Set(s1.split('')), set2 = new Set(s2.split(''));
            const intersection = [...set1].filter(x => set2.has(x)).length;
            const union = set1.size + set2.size - intersection;
            return union ===0 ? 0 : intersection / union;
        }

        // ===================== 5. æ•°æ®æ–‡ä»¶ä¸‹è½½ =====================
        function downloadData(type) {
            const data = type === 'lost' ? GLOBAL_DATA.lost : GLOBAL_DATA.found;
            const title = type === 'lost' ? 'å…¨ç½‘å¤±ç‰©ä¿¡æ¯æ±‡æ€»' : 'å…¨ç½‘æ‹›é¢†ä¿¡æ¯æ±‡æ€»';
            if (data.length ===0) { alert(`æš‚æ— ${type==='lost'?'å¤±ç‰©':'æ‹›é¢†'}æ•°æ®ï¼`); return; }

            let content = `${title}\n${'='.repeat(80)}\nç”Ÿæˆæ—¶é—´ï¼š${new Date().toLocaleString()}\n${'='.repeat(80)}\n\n`;
            data.forEach((item, i) => {
                content += `${i+1}. IDï¼š${item.id}\n   ç‰©å“æè¿°ï¼š${item.desc}\n   è”ç³»äººï¼š${item.contact}\n   è”ç³»æ–¹å¼ï¼š${item.way}\n   ä½ç½®ï¼š${item.place}\n   å‘å¸ƒæ—¶é—´ï¼š${item.time}\n${'-'.repeat(60)}\n\n`;
            });
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `${title}_${new Date().getTime()}.txt`;
            a.click();
            URL.revokeObjectURL(a.href);
        }

        // ===================== 6. å·²å®Œæˆä¿¡æ¯åˆ é™¤ã€æ ¸å¿ƒåŠŸèƒ½ã€‘ =====================
        function deleteSingleData() {
            const delId = document.getElementById('delIdInput').value.trim();
            const type = document.querySelector('input[name="delType"]:checked').value;
            if (!delId) { alert("è¯·è¾“å…¥å¾…åˆ é™¤ä¿¡æ¯çš„IDï¼"); return; }

            const originLen = GLOBAL_DATA[type].length;
            GLOBAL_DATA[type] = GLOBAL_DATA[type].filter(item => item.id != delId);
            saveGlobalData();

            if (GLOBAL_DATA[type].length < originLen) {
                showAlert('tab6Success', `âœ… å•æ¡åˆ é™¤æˆåŠŸï¼ID:${delId}ï¼Œæ‰€æœ‰è®¾å¤‡å·²åŒæ­¥`);
                document.getElementById('delIdInput').value = '';
            } else {
                showAlert('tab6Error', `âŒ åˆ é™¤å¤±è´¥ï¼æœªæ‰¾åˆ°ID:${delId}çš„ä¿¡æ¯`, false);
            }
        }
        function batchDelete() {
            const type = document.querySelector('input[name="delType"]:checked').value;
            const batchType = document.querySelector('input[name="batchType"]:checked').value;
            const keyword = removeAllSpaces(document.getElementById('delKeyInput').value.trim());

            if (batchType === 'key' && !keyword) { alert("è¯·è¾“å…¥æ‰¹é‡åˆ é™¤å…³é”®è¯ï¼"); return; }
            if (!confirm(`âš ï¸ ç¡®è®¤${batchType==='clear'?'æ¸…ç©ºæ‰€æœ‰':'æ‰¹é‡åˆ é™¤å«ã€'+keyword+'ã€‘'}çš„${type==='lost'?'å¤±ç‰©':'æ‹›é¢†'}ä¿¡æ¯ï¼Ÿæ“ä½œä¸å¯é€†ï¼`)) return;

            const originLen = GLOBAL_DATA[type].length;
            if (batchType === 'clear') {
                GLOBAL_DATA[type] = [];
            } else {
                GLOBAL_DATA[type] = GLOBAL_DATA[type].filter(item => !item.desc.includes(keyword));
            }
            saveGlobalData();
            const delCount = originLen - GLOBAL_DATA[type].length;
            showAlert('tab6Success', `âœ… æ‰¹é‡æ“ä½œæˆåŠŸï¼å…±åˆ é™¤${delCount}æ¡ä¿¡æ¯ï¼Œæ‰€æœ‰è®¾å¤‡å·²åŒæ­¥`);
            document.getElementById('delKeyInput').value = '';
        }
    </script>
</body>
</html>
